<!--<< Header Area >>-->
<%- include('head'); -%>

<body class="bg-color2">

    <!-- Preloader Start -->
    <%- include('preloader'); -%>

    <!--<< Mouse Cursor Start >>-->
    <div class="mouse-cursor cursor-outer"></div>
    <div class="mouse-cursor cursor-inner"></div>

    <!-- Back To Top Start -->
    <button id="back-top" class="back-to-top">
        <i class="fa-regular fa-arrow-up"></i>
    </button>

    <!-- Offcanvas Area Start -->
    <%- include('offcanvas'); -%>

    <!-- Header Section Start -->
    <%- include('header'); -%>


    <!-- Search Area Start -->
    <div class="search-wrap">
        <div class="search-inner">
            <i class="fas fa-times search-close" id="search-close"></i>
            <div class="search-cell">
                <form method="get">
                    <div class="search-field-holder">
                        <input type="search" class="main-search-input" placeholder="Search...">
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Breadcumb Section   S T A R T -->
    <div class="breadcumb-section">
        <div class="breadcumb-wrapper" style="background-image: url('https://admin.foodstek.com/upload/slider/<%= bannerData[0].image %>');">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="breadcumb-content">
                            <h1 class="breadcumb-title">FOOD MENU</h1>
                            <ul class="breadcumb-menu">
                                <li><a href="/">Home</a></li>
                                <li class="text-white">/</li>
                                <li class="active">FOOD MENU</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   <!-- foodMenu -->
        <!-- Food Menu section  S T A R T -->
    <section class="food-menu-section fix section-padding">
        
        <div class="burger-shape">
            <img src="/img/shape/burger-shape.png" alt="img">
        </div>
        <div class="fry-shape">
            <img src="/img/shape/fry-shape.png" alt="img">
        </div>
        <div class="food-menu-wrapper style1">
        <div class="shape1 d-none d-xxl-block"><img src="/img/shape/popularDishesShape1_1.png" alt="shape">
            </div>
            <div class="shape2 float-bob-y d-none d-xxl-block"><img src="/img/shape/popularDishesShape1_2.png"
                    alt="shape"></div>
                <div class="food-menu-tab-wrapper style-bg">
                    <div class="title-area">
                        <div class="sub-title text-center wow fadeInUp" data-wow-delay="0.5s">
                            <img class="me-1" src="/img/icon/titleIcon.svg" alt="icon">Foods Cetagory<img class="ms-1"
                                src="/img/icon/titleIcon.svg" alt="icon">
                        </div>
                        <!-- <h2 class="title wow fadeInUp" data-wow-delay="0.7s">
                            Foods Menu
                        </h2> -->
                    </div>


                    <div class="food-menu-tab">
  <!-- Tabs -->
  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <% if (categoryMenu && categoryMenu.length > 0) { %>
      <% categoryMenu.forEach((single_categoryMenu, index) => { %>
    <% 
      const isActive = (activeCategoryId && activeCategoryId == single_categoryMenu.categoryId) || (!activeCategoryId && index === 0);
    %>
        <li class="nav-item" role="presentation">
          <button 
            class="nav-link <%= isActive ? 'active' : '' %>" 
            id="tab-<%= single_categoryMenu.categoryId %>" 
            data-bs-toggle="pill"
            data-bs-target="#tab-<%= single_categoryMenu.categoryId %>-pane" 
            type="button" 
            role="tab"
            aria-controls="tab-<%= single_categoryMenu.categoryId %>-pane" 
            aria-selected="<%= index === 0 ? 'true' : 'false' %>">

            <img 
              width="55" height="55"
              src="https://admin.foodstek.com/upload/category/<%= single_categoryMenu.icon %>" 
              alt="icon">

            <%= single_categoryMenu.categoryName %>
          </button>
        </li>
      <% }) %>
    <% } %>
  </ul>

  <!-- Tab Contents -->
  <div class="tab-content" id="pills-tabContent">
    <% if (categoryMenu && categoryMenu.length > 0) { %>
      <% categoryMenu.forEach((single_categoryMenu, index) => { %>
         <% const isActive = (activeCategoryId && activeCategoryId == single_categoryMenu.categoryId) || (!activeCategoryId && index === 0); %>

        <div 
          class="tab-pane fade <%= isActive ? 'show active' : '' %>" 
          id="tab-<%= single_categoryMenu.categoryId %>-pane" 
          role="tabpanel" 
          aria-labelledby="tab-<%= single_categoryMenu.categoryId %>">

          <div class="food-title">
            <h2><%= single_categoryMenu.categoryName %></h2>
          </div>

          <div class="dishes-card-wrap style1">
            <% if (single_categoryMenu.menu && single_categoryMenu.menu.length > 0) { %>
              <% single_categoryMenu.menu.forEach(single_menu => { %>
                <div class="dishes-card style1">
                  <div class="social-profile">
                    
                    <ul>
                      <li><a href="#" class="view_modal" data-menu-id="<%= single_menu.menuId %>" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="fa-regular fa-basket-shopping-simple"></i></a></li>
                      <li><a href="#" class="view_modal" data-menu-id="<%= single_menu.menuId %>" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="fa-light fa-eye"></i></a></li>
                    </ul>
                  </div>

                  <div class="dishes-thumb">
                    <img 
                      src="https://admin.foodstek.com/upload/menu/<%= single_menu.image %>" 
                      alt="thumb" 
                      width="133" height="132">
                  </div>

                  <a href="/menu">
                    <h3><%= single_menu.menuName %></h3>
                  </a>

                  <p>
                    <% 
                      const desc = single_menu.description || ""; 
                      const shortDesc = desc.length > 20 ? desc.substring(0, 20) + "..." : desc; 
                    %>
                    <%= shortDesc %>
                  </p>

                  <% 
                    const filtered = Array.isArray(single_menu.customeType) 
                      ? single_menu.customeType.filter(type => type.cprice && type.customtype)
                      : [];
                  %>

                  <% if (filtered.length > 0) { %>
                    <h6>$<%= filtered[0].cprice %> - $<%= filtered[filtered.length - 1].cprice %></h6>
                  <% } %>
                </div>
              <% }) %>
            <% } else { %>
              <p>No items available in this category.</p>
            <% } %>
          </div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>


                </div>
            
        </div>
        <div class="marquee-wrapper style-1 text-slider section-padding pt-0 mt-5">
            <div class="marquee-inner to-left">
                <ul class="marqee-list d-flex">
                    <li class="marquee-item style1">
                        <span class="text-slider"></span><span class="text-slider text-style">chicken pizza</span>
                        <span class="text-slider"></span><span class="text-slider text-style">GRILLED CHICKEN</span>
                        <span class="text-slider"></span><span class="text-slider text-style">BURGER</span>
                        <span class="text-slider"></span><span class="text-slider text-style">CHICKEN PIZZA</span>
                        <span class="text-slider"></span><span class="text-slider text-style">FRESH PASTA</span>
                        <span class="text-slider"></span><span class="text-slider text-style">ITALIANO FRENCH FRY</span>
                        <span class="text-slider"></span><span class="text-slider text-style">CHICKEN FRY</span>
                        <span class="text-slider"></span><span class="text-slider text-style">chicken pizza</span>
                        <span class="text-slider"></span><span class="text-slider text-style">GRILLED CHICKEN</span>
                        <span class="text-slider"></span><span class="text-slider text-style">BURGER</span>
                        <span class="text-slider"></span><span class="text-slider text-style">CHICKEN PIZZA</span>
                        <span class="text-slider"></span><span class="text-slider text-style">FRESH PASTA</span>
                        <span class="text-slider"></span><span class="text-slider text-style">ITALIANO FRENCH FRY</span>
                        <span class="text-slider"></span><span class="text-slider text-style">CHICKEN FRY</span>
                    </li>
                </ul>
            </div>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog  modal-dialog-centered">
                <div class="modal-content pb-3 pe-3">
                    <div class="modal-header border-0">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container modal_data">
                            <!-- row => col -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- <script>
  document.addEventListener("DOMContentLoaded", function () {
    // Extract the id parameter from the URL
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id"); // যেমন: pills-drinkJuice
    

    // // Remove the active class from all tab buttons and content
    const allTabs = document.querySelectorAll(".nav-link");
    const allPanes = document.querySelectorAll(".tab-pane");
    allTabs.forEach(tab => tab.classList.remove("active"));
    allPanes.forEach(pane => pane.classList.remove("show", "active"));

    // If the id parameter exists and matches
    if (id) {
      const activeButton = document.querySelector(`[data-bs-target="#${id}"]`);
      const activePane = document.querySelector(`#tab-${id}`);

      if (activeButton && activePane) {
        activeButton.classList.add("active");
        activeButton.setAttribute("aria-selected", "true");
        activePane.classList.add("show", "active");
      }
    } else {
      // If the id parameter does not exist, make the default "FastFood" tab active
      document.querySelector("#pills-FastFood-tab").classList.add("active");
      document.querySelector("#pills-FastFood").classList.add("show", "active");
    }

    // Manual tab click handle (active toggle)
    allTabs.forEach(btn => {
      btn.addEventListener("click", function () {
        allTabs.forEach(tab => tab.classList.remove("active"));
        allPanes.forEach(pane => pane.classList.remove("show", "active"));

        const targetId = btn.getAttribute("data-bs-target");
        const targetPane = document.querySelector(targetId);

        btn.classList.add("active");
        targetPane.classList.add("show", "active");
      });
    });
  });
</script> -->

    <!-- Cta section  S T A R T -->
    <section class="cta-section fix">
        <div class="cta-wrapper style1  section-padding">
            <div class="shape1 float-bob-x d-none d-xxl-block"><img src="/img/shape/ctaShape1_1.png" alt="shape">
            </div>
            <div class="shape2 float-bob-y d-none d-xxl-block"><img src="/img/shape/ctaShape1_2.png" alt="shape">
            </div>
            <div class="shape3 float-bob-y d-none d-xxl-block"><img src="/img/shape/ctaShape1_3.png" alt="shape">
            </div>
            <div class="container">
                <div class="cta-wrap style1">
                    <div class="row">
                        <div class="col-xl-6 order-2 order-xl-1">
                            <div class="cta-content">
                                <h6 class="wow fadeInUp" data-wow-delay="0.5s">WELCOME US BEST</h6>
                                <h3 class="wow fadeInUp" data-wow-delay="0.7s">TODAY SPACIAL FOOD</h3>
                                <p class="wow fadeInUp" data-wow-delay="0.8s">limits Time Offer</p>
                                <a class="theme-btn wow fadeInUp" data-wow-delay="0.9s" href="/menu">ORDER NOW <i
                                        class="fa-sharp fa-regular fa-arrow-right"></i></a>
                            </div>
                        </div>
                        <div class="col-xl-6 order-1 order-xl-2">
                            <div class="cta-thumb">
                                <img class="img-fluid float-bob-x" src="/img/cta/ctaThumb1_1.png" alt="thumb">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Testimonial section  S T A R T -->
    <section class="testimonial-section fix section-padding">
        <div class="testimonial-wrapper style2">
            <div class="container">

                <div class="testimonial-wrap style2">
                    <div class="row gx-80 gy-5">
                        <div class="col-xl-7 order-2 order-xl-1">
                            <div class="title-area">
                                <div class="sub-title text-start wow fadeInUp" data-wow-delay="0.5s">
                                    <img class="me-1" src="/img/icon/titleIcon.svg" alt="icon">TESTIMONIALS<img
                                        class="ms-1" src="/img/icon/titleIcon.svg" alt="icon">
                                </div>
                                <h2 class="title  text-start wow fadeInUp" data-wow-delay="0.7s">
                                    what have lots of happy customer feedback
                                </h2>
                            </div>

                            <div class="slider-area">
                                <div class="swiper testimonialSliderTwo">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">
                                            <div class="testimonial-card style2">
                                                <div class="quote"><img src="/img/icon/quote.svg" alt="icon">
                                                </div>
                                                <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It
                                                    has roots in a piece of classical Latin literature from 45 BC,
                                                    making it over 2000 years old. Richard McClintock !</p>
                                                <div class="profile-box">
                                                    <div class="one"><img
                                                            src="/img/testimonial/testimonialProfile2_1.png"
                                                            alt="thumb"></div>
                                                    <div class="two"><img
                                                            src="/img/testimonial/testimonialProfile2_2.png"
                                                            alt="thumb"></div>
                                                    <div class="three"><img
                                                            src="/img/testimonial/testimonialProfile2_3.png"
                                                            alt="thumb"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="swiper-slide">
                                            <div class="testimonial-card style2">
                                                <div class="quote"><img src="/img/icon/quote.svg" alt="icon">
                                                </div>
                                                <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It
                                                    has roots in a piece of classical Latin literature from 45 BC,
                                                    making it over 2000 years old. Richard McClintock !</p>
                                                <div class="profile-box">
                                                    <div class="one"><img
                                                            src="/img/testimonial/testimonialProfile2_1.png"
                                                            alt="thumb"></div>
                                                    <div class="two"><img
                                                            src="/img/testimonial/testimonialProfile2_2.png"
                                                            alt="thumb"></div>
                                                    <div class="three"><img
                                                            src="/img/testimonial/testimonialProfile2_3.png"
                                                            alt="thumb"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="btn-wrap">
                                        <div class="arrow-prev"><i class="fa-regular fa-arrow-left"></i></div>
                                        <div class="arrow-next"><i class="fa-regular fa-arrow-right"></i></div>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="col-xl-5 order-1 order-xl-2">
                            <div class="testimonial-thumb">
                                <img src="/img/testimonial/testimonialThumb2_1.png" alt="thumb">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Section    S T A R T -->
    <%- include('footer'); -%>



    <!--<< All JS Plugins >>-->
    <%- include('script'); -%>
    <script>
        document.querySelectorAll('.view_modal').forEach(btn => {
            btn.addEventListener("click", async function () {
                const menuId = this.dataset.menuId;
                


                try {
                  const response = await fetch('/getMenuDetails', {

                        method: 'POST',
                        headers: {
                        'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ menuId })
                        });

                        const data = await response.json();

                        if(data.success && data.menu) {
                        const modalWapper = document.querySelector(".modal_data")
                        const {menu, details} = data.menu

                        modalWapper.innerHTML = ""



                         // ✅ Extra Sauce Section
                                let extraSauce = "";
                                if (details.sauce && details.sauce.length > 0) {
                                    const sauceItems = details.sauce
                                    .map(
                                        (item, index) => `
                                        <label  class="fs-5">
                                            <input type="checkbox"
                                            class="extrasauce-checkbox"
                                            style="margin-right:10px"
                                            name="extrasauce[]"
                                            value="${item.sauce}"
                                            data-extrasauce-name="${item.sauce}"
                                            data-price="${item.price}">
                                            ${item.sauce} - $${item.price}
                                        </label><br>

                                        `
                                    )
                                    .join("");

                                    extraSauce = `
                                    <button type="button" class="accordian top-margin">Extra Options</button>
                                    <section class="content" style="max-height: 100vh; overflow: scroll; overflow-x:hidden">
                                        <h6><span>Extra Sauce</span></h6>
                                        ${sauceItems}
                                    </section>
                                    `;
                                }

        // *******
        let sizeOptions  = "";
        if (menu.type === "custom") {
            sizeOptions  = menu.customeType.map((item,index) => `
            <div>
          <input type="radio" 
                 class="size" 
                 name="size" 
                 value="${item.customtype}" 
                 data-price="${item.cprice}" 
                 id="size-${index}">
          <label for="size-${index}">
            ${item.customtype} - $${item.cprice}
          </label>
        </div>
            `).join("")
        } else {
            sizeOptions = `
            
            `
        }

        let sauceOptions = "";
        if(details.sauce.length > 0){
            console.log(details.sauce.length);
            sauceOptions = details.sauce.map((item, index) => `
          <label  class="fs-5">
            <input type="checkbox" 
                   class="sauce-checkbox" 
                   style="margin-right:10px"
                   name="sauce[]" 
                   value="${item.sauceId}" 
                   data-sauce-name="${item.sauce}" 
                   data-price="${item?.price || 0}" 
                   onclick="maxsaucecheck()">
                   ${item.sauce}
          </label><br>
          
        `).join("")
            
        }
        let combo = ""
        if(details.combotag.length > 0){
            combo = details.combotag.map((item, index) =>  `

        <label>
          <input type="checkbox"
            class="extracombotag-checkbox"
            name="extracombotag[]"
            value="${item.combotagId}" 
            data-extracombotag-name="${item.combotagName}"
            data-price="${item.price}">
            ${item.combotagName}
        </label><br>
        
            ` ).join("")
        }

                            const formHtml = `
                        <form id="addToCartForm">
                            <input type="hidden" name="menuId" value="${menu.menuId || ""}" id="menuId"> 
                            <input type="hidden" name="menuName" value="${menu.menuName || ""}" id="menuName"> 
                            <input type="hidden" name="uuid" value="${crypto.randomUUID?.() || "temp-uuid"}" id="uuid"> 

                            ${menu.customeType.length > 0 ? "<h6><span>Select Size</span></h6>" : "" }
                            ${sizeOptions}
                            ${details.sauce.length > 0 ? "<h6><span>Sauce</span></h6>" : "" }
                            ${sauceOptions}
                            ${details.combotag.length > 0 ? "<h6><span>Combo</span></h6>" : "" }
                            ${combo}
                            ${extraSauce || ""}
                        </form>
                        `;


                     const modelData = `
                                <div class="row gy-5">
                                    <div class="col-xxl-5 col-md-12 col-sm-12">
                                        <div class="modal-thumb">
                                            <div class="product-big-img bg-color2">
                                                <div class="dishes-thumb">
                                                    <img class="img-fluid" src="https://admin.foodstek.com/upload/menu/${menu?.image || ''}" alt="thumb">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-details">
                                            <div class="product-about">
                                                <div class="title-wrapper">
                                                    <h2 class="product-title">${menu?.menuName || ''}</h2>
                                                    <div class="price">$ ${menu?.customeType[0].cprice} - $ ${menu?.customeType[menu?.customeType.length -1].cprice}</div>
                                                </div>
                                                <p class="text">${menu?.description}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xxl-7 col-md-12 col-sm-12" style="height: 500px; overflow-y: auto; padding-right: 10px;">
                                        <h2>Item Options</h2>
                                        <p>Required - Choose one.</p>
                                        ${formHtml}
                                    </div>
                                </div>

                                <!-- Button OUTSIDE the form -->
                                <div class="col-xxl-12" style="margin: 0;">
                                    <div class="actions actions2">
                                        <div class="quantity quantity2">
                                            <p>Quantity</p>
                                            <div class="qty-wrapper">
                                                <button type="button" class="quantity-plus qty-btn"><i class="fa-solid fa-plus"></i></button>
                                                <input type="number" class="qty-input" step="1" min="1" max="100" name="quantity" value="1" title="Qty">
                                                <button type="button" class="quantity-minus qty-btn"><i class="fa-solid fa-minus"></i></button>
                                            </div>
                                        </div>
                                        <button type="button" id="submit-button" class="theme-btn">
                                            Add to Cart <i class="fa-regular fa-cart-shopping bg-transparent text-white"></i>
                                        </button>
                                    </div>
                                </div>
                                `;

                        modalWapper.innerHTML = modelData;

                        (function initializeAccordion() {
            const accordions = document.querySelectorAll(".accordian");
            console.log("accordions", accordions);
            
            
            accordions.forEach(function (accordion) {
                accordion.addEventListener("click", function () {
                    this.classList.toggle("active");

                    const content = this.nextElementSibling;
                    if (content.style.display === "block") {
                        content.style.display = "none";
                    }else {
                        content.style.display = "block";
                    } 
                //     if (content.style.maxHeight) {
                //         content.style.maxHeight = null; 
                //     } else {
                //         content.style.maxHeight = content.scrollHeight + "px"; 
                //   }
                });
            });
        })();
                        console.log("menu",menu);
                        console.log("details",details);

                    // data PassIng...

                         const form = document.getElementById("addToCartForm");
                        document.getElementById("submit-button").addEventListener("click", () => {
                            const form = document.getElementById("addToCartForm");
                            if (!form) return console.error("Form not found!");

                            const formData = Object.fromEntries(new FormData(form).entries());

                            // Handle checkboxes (like sauce[] or extrasauce[])
                            form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                                if (cb.checked) {
                                    if (!formData[cb.name] || typeof formData[cb.name] === "string") {
                                        formData[cb.name] = []; // Create array if not exists or is string
                                    }
                                    formData[cb.name].push(cb.value);
                                }
                            });

                            console.log("Form data:", formData);
                        });

                        }

                }
                 catch(error){
                console.error("Error fetching menu details:", error);
                }

            })
        })
    </script>
    
</body>

</html>